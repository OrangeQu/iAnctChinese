
  private List<String> buildRecommendedViews(String category) {
    return switch (category) {
      case "travelogue" -> List.of("åœ°å›¾", "æ—¶é—´è½?, "è¯äº‘");
      case "biography" -> List.of("æ—¶é—´è½?, "äº²æƒ…æ ?, "çŸ¥è¯†å›¾è°±");
      default -> List.of("çŸ¥è¯†å›¾è°±", "å¯¹æŠ—è§†å›¾", "ç»Ÿè®¡å›¾è¡¨");
    };
  }

  private String buildAnalysisSummary(TextDocument text, Stats stats) {
    String categoryLabel = CATEGORY_LABELS.getOrDefault(text.getCategory(), "ç»¼åˆ");
    return String.format(Locale.CHINA,
        "æ¨¡å‹å»ºè®®è¯¥æ–‡æœ¬å½’ç±»ä¸ºã€?sã€ï¼Œå·²å®Œæˆ?%d ä¸ªå®ä½“ã€?d æ¡å…³ç³»ã€‚å»ºè®®ä¼˜å…ˆæŸ¥çœ?%s è§†å›¾ä»¥æ´å¯Ÿå…³é”®ä¿¡æ¯ã€?,
        categoryLabel,
        stats.getEntityCount(),
        stats.getRelationCount(),
        String.join(" / ", buildRecommendedViews(text.getCategory())));
  }

  private List<EntityAnnotation> generateEntitiesForCategory(TextDocument text) {
    List<EntityAnnotation> entities = new ArrayList<>();
    switch (text.getCategory()) {
      case "travelogue" -> entities.addAll(List.of(
          buildEntity(text, "ä½œè€?, EntityCategory.PERSON, 0, 2, 0.95),
          buildEntity(text, "åå±±", EntityCategory.LOCATION, 15, 17, 0.8),
          buildEntity(text, "æ±Ÿæ²³", EntityCategory.LOCATION, 30, 32, 0.78)
      ));
      case "biography" -> entities.addAll(List.of(
          buildEntity(text, "ä¸»äººå…?, EntityCategory.PERSON, 0, 3, 0.96),
          buildEntity(text, "çˆ¶äº²", EntityCategory.PERSON, 10, 12, 0.82),
          buildEntity(text, "å®˜èŒ", EntityCategory.ORGANIZATION, 40, 42, 0.75)
      ));
      default -> entities.addAll(List.of(
          buildEntity(text, "ä¸»å¸…", EntityCategory.PERSON, 0, 2, 0.94),
          buildEntity(text, "æ•Œå†›", EntityCategory.ORGANIZATION, 20, 22, 0.78),
          buildEntity(text, "æˆ˜åœº", EntityCategory.LOCATION, 35, 37, 0.81)
      ));
    }
    return entities;
  }

  private EntityAnnotation buildEntity(TextDocument text, String label, EntityCategory category,
      int start, int end, double confidence) {
    return EntityAnnotation.builder()
        .textDocument(text)
        .startOffset(start)
        .endOffset(end)
        .label(label)
        .category(category)
        .confidence(confidence)
        .color("#d16a5d")
        .build();
  }

  private List<RelationAnnotation> generateRelationsForCategory(TextDocument text,
      List<EntityAnnotation> entities) {
    if (entities.size() < 2) {
      return List.of();
    }
    List<RelationAnnotation> relations = new ArrayList<>();
    EntityAnnotation first = entities.get(0);
    EntityAnnotation second = entities.get(1);
    RelationAnnotation.RelationType relationType = switch (text.getCategory()) {
      case "travelogue" -> RelationType.TRAVEL;
      case "biography" -> RelationType.FAMILY;
      default -> RelationType.CONFLICT;
    };
    relations.add(RelationAnnotation.builder()
        .textDocument(text)
        .source(first)
        .target(second)
        .relationType(relationType)
        .confidence(0.72)
        .evidence("ç¤ºä¾‹æ¨ç†")
        .build());
    return relations;
  }
}

